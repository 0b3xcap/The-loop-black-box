<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>SED W28 â€“ Chemical Handling (16:9)</title>
  <style>
    :root{
      --text-base: clamp(1.4rem, 3vmin, 2.6rem);
      --pad: 2rem;
      --fade: 2s;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: black; /* letterboxing */
      font-family: 'Space Mono', monospace;
      color: white;
      overscroll-behavior: none;
      touch-action: manipulation;
      -webkit-font-smoothing: antialiased;
      user-select: none;
      height: 100%;
      width: 100%;
    }

    /* 16:9 stage centered with bars as needed */
    .stage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: black;
      overflow: hidden;
      width: 100vw;
      height: calc(100vw * 9 / 16);
    }
    @media (min-aspect-ratio: 16/9) {
      .stage { width: calc(100vh * 16 / 9); height: 100vh; }
    }

    /* Base layer: hidden until shown */
    .layer {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--fade) ease, visibility 0s linear var(--fade);
      pointer-events: none;
      will-change: opacity;
    }
    .show {
      opacity: 1;
      visibility: visible;
      transition: opacity var(--fade) ease, visibility 0s;
    }

    .slide {
      z-index: 1;
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover; /* default fill */
    }
    /* Fit slide 3 (no cropping) */
    #slide3 {
      background-size: contain;
      background-color: black;
    }

    .text {
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: var(--pad);
      box-sizing: border-box;
      font-size: var(--text-base);
      line-height: 1.4;
      text-shadow: 0 0 10px rgba(0,0,0,0.6);
    }

    .yellow { color: #ffcc00; }
    .final  { color: #fff; }

    /* Start overlay (clickable) */
    #startScreen {
      z-index: 10;
      background: black;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-size: clamp(1rem, 2.2vmin, 1.6rem);
      /* Start visible */
      opacity: 1;
      visibility: visible;
      transition: opacity var(--fade) ease, visibility 0s linear var(--fade);
      pointer-events: auto;
    }
    #startButton {
      position: absolute; inset: 0;
      background: transparent; border: none; cursor: pointer;
    }
    #startScreenText { text-align: center; line-height: 1.4em; }
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <!-- Audio (your updated filenames kept verbatim) -->
    <audio id="chime1" src="F%20CHIME%20PAUL.wav" preload="auto"></audio>
    <audio id="chime2" src="F%20CHIME%20STD%20.wav" preload="auto"></audio>

    <!-- Start screen -->
    <div id="startScreen" class="layer show">
      <div id="startScreenText">
        SAFELY EVERY DAY<br>
        <span style="font-style: italic; font-size: 0.7em;">Tap or click to begin</span>
      </div>
      <button id="startButton" aria-label="Start"></button>
    </div>

    <!-- Slides -->
    <div class="layer slide" id="slide1" style="background-image: url('MENTAL3HD2.PNG');"></div>
    <div class="layer slide" id="slide2" style="background-image: url('MENTAL4HD2.PNG');"></div>
    <div class="layer slide" id="slide3" style="background-image: url('SEDWK37HD.png');"></div>

    <!-- Text -->
    <div class="layer text" id="text1">A simple question can change someone's day.</div>
    <div class="layer text yellow" id="text2">Listening is the strongest form of support.</div>
    <div class="layer text final"  id="text3">R U OK? Four letters that open real conversation.</div>
  </div>

  <script>
    const chime1 = document.getElementById('chime1');
    const chime2 = document.getElementById('chime2');
    const startScreen = document.getElementById('startScreen');
    const startButton = document.getElementById('startButton');

    // Helpers
    function show(id){ const el = document.getElementById(id); if(el){ el.classList.add('show'); } }
    function hide(id){ const el = document.getElementById(id); if(el){ el.classList.remove('show'); } }

    function fadeOutAudio(audio, duration = 5000){
      if(!audio) return;
      const steps = 50, stepTime = duration/steps, volumeStep = (audio.volume||1)/steps;
      let i = 0;
      const t = setInterval(()=>{
        if(i++ < steps){ audio.volume = Math.max(0, audio.volume - volumeStep); }
        else { clearInterval(t); try{ audio.pause(); }catch{} }
      }, stepTime);
    }

    // Sequence (unchanged timings)
    const sequence = [
      [()=>{},                     2000],
      [()=>show('slide1'),            0],
      [()=>{},                     2000],
      [()=>show('text1'),             0],
      [()=>{},                     6500],
      [()=>hide('slide1'),            0],
      [()=>{},                     2000],
      [()=>hide('text1'),             0],
      [()=>{},                     1000],
      [()=>show('slide2'),            0],
      [()=>{},                     2000],
      [()=>show('text2'),             0],
      [()=>{},                     6500],
      [()=>hide('slide2'),            0],
      [()=>{},                     2000],
      [()=>hide('text2'),             0],
      [()=>{},                     1000],
      [()=>show('slide3'),            0],
      [()=>{},                    25000],
      [()=>hide('slide3'),            0],
      [()=>{},                     1000],
      [()=>show('text3'),             0],
      [()=>{},                     5000],
      [()=>hide('text3'),             0],
    ];

    let step = 0;
    function runSequence(){
      if(step >= sequence.length) return;
      const [fn, delay] = sequence[step];
      try{ fn(); }catch{}
      step++;
      setTimeout(runSequence, delay);
    }

    function start(withAudio = true){
      // Clean start every time
      step = 0;

      // Hide and disable the start overlay after fade
      startScreen.style.opacity = '0';
      startScreen.style.visibility = 'hidden';
      startScreen.style.pointerEvents = 'none';

      // Audio (non-blocking)
      if(withAudio){
        try{
          chime1.volume = 1; chime2.volume = 1;
          chime1.currentTime = 0; chime2.currentTime = 0;
          chime1.play(); chime2.play();
          setTimeout(()=>{ fadeOutAudio(chime1, 5000); fadeOutAudio(chime2, 5000); }, 35000);
        }catch{}
      }

      // Ensure first paint occurs before we start the fades
      requestAnimationFrame(()=> {
        // tiny delay to guarantee style recalculation
        setTimeout(runSequence, 60);
      });
    }

    // Primary interaction
    startButton.addEventListener('click', ()=> start(true));

    // Fallback: silent autostart after 5s (in case no one clicks)
    let autoStartTimer = setTimeout(()=>{
      if(getComputedStyle(startScreen).visibility !== 'hidden') start(false);
    }, 5000);

    // Any interaction cancels silent autostart
    ['pointerdown','keydown'].forEach(evt=>{
      window.addEventListener(evt, ()=> clearTimeout(autoStartTimer), { once:true });
    });
  </script>
</body>
</html>
